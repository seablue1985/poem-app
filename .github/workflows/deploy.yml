name: Deploy Static Site to GitHub Pages

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
      # æ­¥éª¤ 1: æ£€å‡ºä»£ç 
      - name: Checkout code
        uses: actions/checkout@v4
        
      # æ­¥éª¤ 2: éªŒè¯ HTML æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
      - name: Validate HTML file
        run: |
          echo "æ­£åœ¨éªŒè¯ index.html æ–‡ä»¶..."
          
          # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          if [ ! -f "index.html" ]; then
            echo "é”™è¯¯: index.html æ–‡ä»¶ä¸å­˜åœ¨ï¼"
            echo "å½“å‰ç›®å½•å†…å®¹:"
            ls -la
            exit 1
          fi
          
          # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºç©º
          if [ ! -s "index.html" ]; then
            echo "é”™è¯¯: index.html æ–‡ä»¶ä¸ºç©ºï¼"
            exit 1
          fi
          
          # æ£€æŸ¥æ–‡ä»¶åŸºæœ¬ç»“æ„
          if ! grep -q "<!DOCTYPE html>" "index.html"; then
            echo "è­¦å‘Š: index.html ç¼ºå°‘ DOCTYPE å£°æ˜"
          fi
          
          if ! grep -q "<html" "index.html"; then
            echo "è­¦å‘Š: index.html ç¼ºå°‘ <html> æ ‡ç­¾"
          fi
          
          if ! grep -q "</html>" "index.html"; then
            echo "è­¦å‘Š: index.html ç¼ºå°‘ </html> é—­åˆæ ‡ç­¾"
          fi
          
          echo "âœ… HTML æ–‡ä»¶éªŒè¯é€šè¿‡"
          echo "æ–‡ä»¶å¤§å°: $(wc -c < index.html) å­—èŠ‚"
          
      # æ­¥éª¤ 3: è®¾ç½® Pages
      - name: Setup Pages
        uses: actions/configure-pages@v4
        
      # æ­¥éª¤ 4: ä¸Šä¼ äº§ç‰©
      - name: Upload Pages artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.'  # ä¸Šä¼ æ•´ä¸ªå½“å‰ç›®å½•
          
      # æ­¥éª¤ 5: éƒ¨ç½²
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
        
      # æ­¥éª¤ 6: è¾“å‡ºéƒ¨ç½²ä¿¡æ¯
      - name: Display deployment info
        run: |
          echo "========================================"
          echo "ğŸ‰ éƒ¨ç½²æˆåŠŸï¼"
          echo "ğŸŒ ç½‘ç«™åœ°å€: ${{ steps.deployment.outputs.page_url }}"
          echo "ğŸ“ éƒ¨ç½²åˆ†æ”¯: ${{ github.ref }}"
          echo "ğŸ‘¤ è§¦å‘ç”¨æˆ·: ${{ github.actor }}"
          echo "ğŸ• éƒ¨ç½²æ—¶é—´: $(date)"
          echo "========================================"
